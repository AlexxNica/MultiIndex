<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MultiIndex: How to search in a multi-index</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MultiIndex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to search in a multi-index </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ALGO">The search algorithm</a></li>
<li class="level1"><a href="#FORMATS">File formats</a></li>
<li class="level1"><a href="#EXAMPLE">Search sample</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ALGO"></a>
The search algorithm</h1>
<p>Given a query point, the search algorithm traverses the inverted multi-index entries in the order of increasing distance from the entry centroid to the query as descibed in the <a href="http://download.yandex.ru/company/cvpr2012.pdf">paper</a>. <br/>
 It accumulates the points from the traversed entries and stops when their count reaches the value requested by the user.<br/>
 If rerank mode is on (flag &ndash;do_rerank is set) the code also estimates the distance to query for every traversed point using the extra information stored for reranking. In this case, the traversed points are sorted by the increasing distance estimate.<br/>
</p>
<p>As for the index construction, you should provide the coarse vocabularies and the fine vocabularies (these should be the same vocabularies as used for the index construction). To measure the accuracy of the system, you should provide a file with a list of query points and the ground truth nearest neighbors.<br/>
</p>
<h1><a class="anchor" id="FORMATS"></a>
File formats</h1>
<ul>
<li><b>Queries</b> <br/>
 Our code assumes that queries are in the <a href="http://corpus-texmex.irisa.fr">.bvecs</a> or the <a href="http://corpus-texmex.irisa.fr">.bvecs</a> format.<br/>
</li>
<li><b>Groundtruth</b> <br/>
 Our code assumes that the ground truth nearest neighbors are in this <a href="http://corpus-texmex.irisa.fr">.ivecs</a> format.<br/>
</li>
<li><b>Coarse vocabularies</b><br/>
 Our code assumes that coarse vocabularies are in the following format:<br/>
 4 bytes(one int32) - number of items in each vocabulary (N)<br/>
 4 bytes(one int32) - dimension of item (d)<br/>
 4*N*d*M bytes(N*d*M floats) - vocabulary items one after another (M is the multiplicity of algorithm)<br/>
</li>
<li><b>Fine vocabularies</b><br/>
 Our code assumes that fine vocabularies are in the following format:<br/>
 4 bytes(one int32) - number of vocabularies (m)<br/>
 4 bytes(one int32) - number of items in each vocabulary (N)<br/>
 4 bytes(one int32) - dimension of item (d)<br/>
 4*N*d*m bytes(N*d*m floats) - vocabulary items (each centroid is stored contiguously<br/>
</li>
</ul>
<h1><a class="anchor" id="EXAMPLE"></a>
Search sample</h1>
<p>To launch the search for all queries and to estimate the accuracy of the search algorithm run the "searcher_tester" application. The following command-line options control the execution: </p>
<div class="fragment"><div class="line">--<a class="code" href="indexer__launcher_8cpp.html#a1e634836578ca163d1cda119acfbcafc">coarse_vocabs_file</a>        - the path to the file with coarse vocabs (see the format description above)</div>
<div class="line">--<a class="code" href="indexer__launcher_8cpp.html#a975dce76db4dab6f67d0c2239239ac6e">fine_vocabs_file</a>          - the path to the file with fine vocabs <span class="keywordflow">for</span> reranking(see the format description above)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#ae60f3d7f31136a9e14ce70851f21f56b">query_point_type</a>          - <span class="stringliteral">&quot;BVEC&quot;</span> or <span class="stringliteral">&quot;FVEC&quot;</span></div>
<div class="line">--use_residuals             - the reranking method flag. Specify it <span class="keywordflow">if</span> you are <span class="keyword">using</span> the residuals <span class="keywordflow">for</span> reranking (Multi-D-ADC) and omit it if you are using the initial vector (Multi-ADC)</div>
<div class="line">--space_dim                 - space dimensionality (e.g. 128 for SIFTs)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a169590278a3075901762f4069eace181">subspaces_centroids_count</a> - the number of nearest vocabulary items to consider (L in the paper)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a1fb94c566502389bc35ae2ffcfafcb6c">index_files_prefix</a>        - the common prefix of the multi-index files (to control runs with different parameters)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a57c9488d6779e505045e9c70bb12f52f">queries_file</a>              - the path to the file with queries (should be in .bvecs or .fvecs format)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a577098af4eb0039f92fb1def68e4fde1">groundtruth_file</a>          - the path to the file with groundtruth (should be in .ivecs format)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a6c12b46d7c5a836306e73859284bd0f4">queries_count</a>             - the number of queries to search</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a58870be1a47ffb790df6e3f7e7141089">neighbours_count</a>          - the number of neighbours involved in reranking</div>
<div class="line">--<a class="code" href="perfomance__util_8cpp.html#a83ba57579d319169b6f3242155289418">report_file</a>               - the path to the file to store the search quality report</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a527b9abb2ca1ddfdcc18f0faaab0483b">do_rerank</a>                 - this flag indicates whether the search algorithm should rerank points based on the estimated distance to the query</div>
</div><!-- fragment --><p>Windows users can try test_searcher.bat script. It launches search in the index builded by launch_indexer.bat script. Unix users should just write a similar test_searcher.sh script. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Aug 16 2012 17:51:53 for MultiIndex by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>

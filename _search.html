<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>MultiIndex: How to search</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">MultiIndex
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.1.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">How to search </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#ALGO">Algorithm</a></li>
<li class="level1"><a href="#FORMATS">File formats</a></li>
<li class="level1"><a href="#EXAMPLE">Search sample</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="ALGO"></a>
Algorithm</h1>
<p>Search algorithm traverses inverted multiindex structure by order descibed in <a href="http://download.yandex.ru/company/cvpr2012.pdf">paper</a>. <br/>
 It accumulates traversed points and stops when their count reaches the value defined by the user.<br/>
 If rerank mode is on (flag &ndash;do_rerank is specified) method also calculates estimation of distance to query for every traversed point. Then all traversed points are sorted by increasing of this estimation.<br/>
</p>
<p>For search you should provide coarse vocabularies and fine vocabularies used for indexing. Besides you should provide file with queries and groundtruth for testing quality.<br/>
</p>
<h1><a class="anchor" id="FORMATS"></a>
File formats</h1>
<ul>
<li><b>Queries</b> <br/>
 Our code assumes that queries are in .bvecs or .fvecs format.<br/>
</li>
<li><b>Groundtruth</b> <br/>
 Our code assumes that groundtruth are in .ivecs format.<br/>
</li>
<li><b>Coarse vocabularies</b><br/>
 Our code assumes that coarse vocabularies are in the next format:<br/>
 4 bytes(one int32) - number of items in each vocabulary (N)<br/>
 4 bytes(one int32) - dimension of item (d)<br/>
 4*N*d*M bytes(N*d*M floats) - vocabulary items one after another (M is the multiplicity of algorithm)<br/>
</li>
<li><b>Fine vocabularies</b><br/>
 Our code assumes that fine vocabularies are in the next format:<br/>
 4 bytes(one int32) - number of vocabularies (m)<br/>
 4 bytes(one int32) - number of items in each vocabulary (N)<br/>
 4 bytes(one int32) - dimension of item (d)<br/>
 4*N*d*m bytes(N*d*m floats) - vocabulary items one after another<br/>
</li>
</ul>
<h1><a class="anchor" id="EXAMPLE"></a>
Search sample</h1>
<p>To launch search and get quality of search algorithm you should run "searcher_tester" application with some command line parameters. </p>
<div class="fragment"><div class="line">--<a class="code" href="indexer__launcher_8cpp.html#a1e634836578ca163d1cda119acfbcafc">coarse_vocabs_file</a>        - path to file with coarse vocabs (format description)</div>
<div class="line">--<a class="code" href="indexer__launcher_8cpp.html#a975dce76db4dab6f67d0c2239239ac6e">fine_vocabs_file</a>          - path to file with fine vocabs <span class="keywordflow">for</span> reranking(format description)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#ae60f3d7f31136a9e14ce70851f21f56b">query_point_type</a>          - <span class="stringliteral">&quot;BVEC&quot;</span> or <span class="stringliteral">&quot;FVEC&quot;</span></div>
<div class="line">--use_residuals             - reranking method flag (specify it <span class="keywordflow">if</span> you want to use residuals <span class="keywordflow">for</span> reranking and miss it <span class="keywordflow">if</span> you want to use initial points)</div>
<div class="line">--space_dim                 - number of dimensions in point</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a169590278a3075901762f4069eace181">subspaces_centroids_count</a> - number of nearest vocabulary items to consider</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a1fb94c566502389bc35ae2ffcfafcb6c">index_files_prefix</a>        - common prefix of multiindex files</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a57c9488d6779e505045e9c70bb12f52f">queries_file</a>              - path to file with queries (should be in .bvecs or .fvecs format)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a577098af4eb0039f92fb1def68e4fde1">groundtruth_file</a>          - path to file with groundtruth (should be in .ivecs format)</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a6c12b46d7c5a836306e73859284bd0f4">queries_count</a>             - number of queries to search</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a58870be1a47ffb790df6e3f7e7141089">neighbours_count</a>          - number of neighbours involved in reranking</div>
<div class="line">--<a class="code" href="perfomance__util_8cpp.html#a83ba57579d319169b6f3242155289418">report_file</a>               - path to file with search quality report</div>
<div class="line">--<a class="code" href="searcher__tester_8cpp.html#a527b9abb2ca1ddfdcc18f0faaab0483b">do_rerank</a>                 - <span class="keyword">this</span> flag indicate whether search algorithm should rerank points based on distance to query estimation</div>
</div><!-- fragment --><p>Windows users can try test_searcher.bat script. It launches search in index builded by launch_indexer.bat script. Unix users should just write a similar test_searcher.sh script. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sat Aug 11 2012 19:15:23 for MultiIndex by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.1.2
</small></address>
</body>
</html>
